<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .clip-visual-timeline {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #444;
        }

        .timeline-ruler {
            display: flex;
            justify-content: space-between;
            padding: 0 0 8px 0;
            border-bottom: 1px solid #555;
            margin-bottom: 10px;
            position: relative;
        }

        .timeline-marker {
            font-size: 11px;
            color: #999;
            font-family: monospace;
        }

        .timeline-track {
            position: relative;
            height: 50px;
            background: #1a1a1a;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
        }

        .timeline-selection {
            position: absolute;
            top: 5px;
            left: 0;
            height: 40px;
            width: 100px;
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            border-radius: 4px;
            cursor: move;
            display: flex;
            align-items: center;
            user-select: none;
        }

        .timeline-selection-body {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 8px;
            overflow: hidden;
        }

        .timeline-time-label {
            color: white;
            font-size: 12px;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
        }

        .timeline-handle {
            width: 12px;
            height: 100%;
            background: white;
            cursor: ew-resize;
            position: relative;
            flex-shrink: 0;
        }

        .timeline-handle-left {
            border-radius: 4px 0 0 4px;
        }

        .timeline-handle-right {
            border-radius: 0 4px 4px 0;
        }
        
        .debug-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .debug-info div {
            margin: 5px 0;
        }
        
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #357abd;
        }
    </style>
</head>
<body>
    <h1>üîç Timeline Positioning Debug Test</h1>
    
    <div class="test-container">
        <h3>Test Timeline</h3>
        <p>This simulates the clip timeline with a 240-second video and begin=4s, duration=3s</p>
        
        <div class="clip-visual-timeline">
            <div class="timeline-ruler" id="timelineRuler">
                <div class="timeline-marker">0s</div>
                <div class="timeline-marker">15s</div>
                <div class="timeline-marker">30s</div>
                <div class="timeline-marker">45s</div>
                <div class="timeline-marker">60s</div>
                <div class="timeline-marker">75s</div>
                <div class="timeline-marker">90s</div>
                <div class="timeline-marker">105s</div>
                <div class="timeline-marker">120s</div>
            </div>
            <div class="timeline-track" id="timelineTrack">
                <div class="timeline-selection" id="timelineSelection">
                    <div class="timeline-handle timeline-handle-left"></div>
                    <div class="timeline-selection-body">
                        <span class="timeline-time-label" id="timelineTimeLabel">0.0s - 5.0s</span>
                    </div>
                    <div class="timeline-handle timeline-handle-right"></div>
                </div>
            </div>
        </div>
        
        <button onclick="testPosition()">Test Position (begin=4s, duration=3s)</button>
        <button onclick="testPosition2()">Test Position (begin=10s, duration=5s)</button>
        <button onclick="testPosition3()">Test Position (begin=60s, duration=10s)</button>
        <button onclick="resetPosition()">Reset to 0s</button>
        
        <div class="debug-info" id="debugInfo">
            <div><strong>Debug Info:</strong></div>
            <div id="debugOutput">Click a button to test positioning...</div>
        </div>
    </div>

    <script>
        function updateDebugInfo(info) {
            document.getElementById('debugOutput').innerHTML = Object.entries(info)
                .map(([key, value]) => `<div><strong>${key}:</strong> ${value}</div>`)
                .join('');
        }
        
        function positionTimeline(begin, duration, videoDuration) {
            const timelineTrack = document.getElementById('timelineTrack');
            const timelineSelection = document.getElementById('timelineSelection');
            const timelineTimeLabel = document.getElementById('timelineTimeLabel');
            
            const trackWidth = timelineTrack.offsetWidth;
            const pixelsPerSecond = trackWidth / videoDuration;
            
            const leftPx = begin * pixelsPerSecond;
            const widthPx = duration * pixelsPerSecond;
            
            // Apply styles
            timelineSelection.style.left = `${leftPx}px`;
            timelineSelection.style.width = `${widthPx}px`;
            
            // Update label
            timelineTimeLabel.textContent = `${begin.toFixed(1)}s - ${(begin + duration).toFixed(1)}s`;
            
            // Debug info
            updateDebugInfo({
                'Video Duration': `${videoDuration}s`,
                'Begin': `${begin}s`,
                'Duration': `${duration}s`,
                'Track Width': `${trackWidth}px`,
                'Pixels Per Second': `${pixelsPerSecond.toFixed(2)}px/s`,
                'Calculated Left': `${leftPx.toFixed(2)}px`,
                'Calculated Width': `${widthPx.toFixed(2)}px`,
                'Applied Left': timelineSelection.style.left,
                'Applied Width': timelineSelection.style.width,
                'Actual offsetLeft': `${timelineSelection.offsetLeft}px`,
                'Actual offsetWidth': `${timelineSelection.offsetWidth}px`
            });
            
            console.log('Position applied:', {
                begin, duration, videoDuration,
                trackWidth, pixelsPerSecond,
                leftPx, widthPx,
                appliedLeft: timelineSelection.style.left,
                appliedWidth: timelineSelection.style.width
            });
        }
        
        function testPosition() {
            positionTimeline(4, 3, 240);
        }
        
        function testPosition2() {
            positionTimeline(10, 5, 240);
        }
        
        function testPosition3() {
            positionTimeline(60, 10, 240);
        }
        
        function resetPosition() {
            positionTimeline(0, 5, 240);
        }
        
        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('Auto-testing position...');
                testPosition();
            }, 100);
        });
    </script>
</body>
</html>
